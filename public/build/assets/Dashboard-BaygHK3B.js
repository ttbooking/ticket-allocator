import{T as Be}from"./TransitionGroup-BgnYxbGH.js";import{r as W,g as q,p as J,u as qe,c as u,a as Q,V as A,b as r,d as i,n as be,e as N,F as Y,m as K,o as Re,f as Je,s as Qe,k as Me,h as et,i as tt,j as ot,l as at,q as pe,w as Pe,t as nt,v as X,x as Ee,y as st,z as Ae,A as We,B as De,C as Oe,D as lt,E as it,G as rt,M as ut,H as ct,I as dt,J as ye,K as vt,L as ft,N as mt,O as ht,P as pt,Q as yt,R as se,S as gt,T as kt,U as Ce,W as te,X as x,Y as k,Z as m,_ as R,$ as F,a0 as Le,a1 as d,a2 as S,a3 as b,a4 as ne,a5 as le,a6 as oe,a7 as Ue,a8 as wt,a9 as ue,aa as z,ab as G,ac as ge,ad as bt,ae as _t,af as he,ag as Vt,ah as Tt,ai as $t,aj as Ct}from"./app-otYoHxcR.js";import{u as Z,i as xt,M as St,a as It,b as He,c as je,d as Bt,e as Rt,T as Xe,f as Mt,g as Pt,h as Et,C as At,O as L,j as U,V as Wt,k as Dt,l as Ot,m as Lt,n as Ut}from"./VSwitch-CRrIoD8p.js";import{u as Ht,m as jt,V as xe,a as Xt,b as Yt}from"./filter-iyhSvtek.js";import{V as Nt,a as Ft}from"./VCard-D-U6cOp4.js";import{f as Gt}from"./VInput-DYjilnZG.js";import{a as zt}from"./VTextField-DfjmGmgX.js";import{V as Zt}from"./VContainer-RdoBRZXB.js";import{V as Se,a as ce}from"./VRow-BE9wERAF.js";import{V as Ie}from"./VAutocomplete-B_oQyoke.js";import{V as Kt}from"./VTable-By867l_G.js";import"./VSelectionControl-Cyaij7AO.js";import"./VCheckboxBtn-BJNC-ryv.js";/* empty css              */function qt(e,t){const o=W();return Z(e,"dragstart",a=>{if(o.value=a.target,typeof t=="string"){const n=t;t=(l,s)=>{s?.setData("text/plain",l.dataset[n]??"")}}t?.(o.value,a.dataTransfer)}),Z(e,"dragend",()=>{o.value=null}),{element:o}}function Ye(e,t,o=!0){const a=W(!1);let n=0;return xt&&(Z(e,"dragenter",l=>{l.preventDefault(),n++,a.value=!0}),Z(e,"dragover",l=>{l.preventDefault()}),Z(e,"dragleave",l=>{l.preventDefault(),n--,n===0&&(a.value=!1)}),Z(e,"drop",l=>{if(l.preventDefault(),n=0,a.value=!1,t)if(o){const s=Array.from(l.dataTransfer?.files??[]);t(s.length===0?null:s)}else t(l.dataTransfer)})),{isOverDropZone:a}}const _e=Symbol.for("vuetify:v-tabs"),Jt=J({fixed:Boolean,sliderColor:String,hideSlider:Boolean,direction:{type:String,default:"horizontal"},...Re(Je({selectedClass:"v-tab--selected",variant:"text"}),["active","block","flat","location","position","symbol"])},"VTab"),de=q()({name:"VTab",props:Jt(),setup(e,t){let{slots:o,attrs:a}=t;const{textColorClasses:n,textColorStyles:l}=qe(()=>e.sliderColor),s=W(),w=W(),v=u(()=>e.direction==="horizontal"),f=u(()=>s.value?.group?.isSelected.value??!1);function p(T){let{value:y}=T;if(y){const I=s.value?.$el.parentElement?.querySelector(".v-tab--selected .v-tab__slider"),$=w.value;if(!I||!$)return;const P=getComputedStyle(I).color,M=I.getBoundingClientRect(),B=$.getBoundingClientRect(),D=v.value?"x":"y",O=v.value?"X":"Y",V=v.value?"right":"bottom",c=v.value?"width":"height",g=M[D],_=B[D],C=g>_?M[V]-B[V]:M[D]-B[D],H=Math.sign(C)>0?v.value?"right":"bottom":Math.sign(C)<0?v.value?"left":"top":"center",ve=(Math.abs(C)+(Math.sign(C)<0?M[c]:B[c]))/Math.max(M[c],B[c])||0,fe=M[c]/B[c]||0,ie=1.5;zt($,{backgroundColor:[P,"currentcolor"],transform:[`translate${O}(${C}px) scale${O}(${fe})`,`translate${O}(${C/ie}px) scale${O}(${(ve-1)/ie+1})`,"none"],transformOrigin:Array(3).fill(H)},{duration:225,easing:Qe})}}return Q(()=>{const T=A.filterProps(e);return r(A,K({symbol:_e,ref:s,class:["v-tab",e.class],style:e.style,tabindex:f.value?0:-1,role:"tab","aria-selected":String(f.value),active:!1},T,a,{block:e.fixed,maxWidth:e.fixed?300:void 0,"onGroup:selected":p}),{...o,default:()=>i(Y,null,[o.default?.()??e.text,!e.hideSlider&&i("div",{ref:w,class:N(["v-tab__slider",n.value]),style:be(l.value)},null)])})}),Gt({},s)}}),Qt=e=>{const{touchstartX:t,touchendX:o,touchstartY:a,touchendY:n}=e,l=.5,s=16;e.offsetX=o-t,e.offsetY=n-a,Math.abs(e.offsetY)<l*Math.abs(e.offsetX)&&(e.left&&o<t-s&&e.left(e),e.right&&o>t+s&&e.right(e)),Math.abs(e.offsetX)<l*Math.abs(e.offsetY)&&(e.up&&n<a-s&&e.up(e),e.down&&n>a+s&&e.down(e))};function eo(e,t){const o=e.changedTouches[0];t.touchstartX=o.clientX,t.touchstartY=o.clientY,t.start?.({originalEvent:e,...t})}function to(e,t){const o=e.changedTouches[0];t.touchendX=o.clientX,t.touchendY=o.clientY,t.end?.({originalEvent:e,...t}),Qt(t)}function oo(e,t){const o=e.changedTouches[0];t.touchmoveX=o.clientX,t.touchmoveY=o.clientY,t.move?.({originalEvent:e,...t})}function ao(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={touchstartX:0,touchstartY:0,touchendX:0,touchendY:0,touchmoveX:0,touchmoveY:0,offsetX:0,offsetY:0,left:e.left,right:e.right,up:e.up,down:e.down,start:e.start,move:e.move,end:e.end};return{touchstart:o=>eo(o,t),touchend:o=>to(o,t),touchmove:o=>oo(o,t)}}function no(e,t){const o=t.value,a=o?.parent?e.parentElement:e,n=o?.options??{passive:!0},l=t.instance?.$.uid;if(!a||!l)return;const s=ao(t.value);a._touchHandlers=a._touchHandlers??Object.create(null),a._touchHandlers[l]=s,Me(s).forEach(w=>{a.addEventListener(w,s[w],n)})}function so(e,t){const o=t.value?.parent?e.parentElement:e,a=t.instance?.$.uid;if(!o?._touchHandlers||!a)return;const n=o._touchHandlers[a];Me(n).forEach(l=>{o.removeEventListener(l,n[l])}),delete o._touchHandlers[a]}const ke={mounted:no,unmounted:so},Ne=Symbol.for("vuetify:v-window"),Fe=Symbol.for("vuetify:v-window-group"),Ge=J({continuous:Boolean,nextIcon:{type:[Boolean,String,Function,Object],default:"$next"},prevIcon:{type:[Boolean,String,Function,Object],default:"$prev"},reverse:Boolean,showArrows:{type:[Boolean,String],validator:e=>typeof e=="boolean"||e==="hover"},verticalArrows:[Boolean,String],touch:{type:[Object,Boolean],default:void 0},direction:{type:String,default:"horizontal"},modelValue:null,disabled:Boolean,selectedClass:{type:String,default:"v-window-item--active"},mandatory:{type:[Boolean,String],default:"force"},...We(),...Ae(),...st()},"VWindow"),we=q()({name:"VWindow",directives:{vTouch:ke},props:Ge(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const{themeClasses:a}=et(e),{isRtl:n}=tt(),{t:l}=ot(),s=at(e,Fe),w=W(),v=u(()=>n.value?!e.reverse:e.reverse),f=pe(!1),p=u(()=>{const V=e.direction==="vertical"?"y":"x",g=(v.value?!f.value:f.value)?"-reverse":"";return`v-window-${V}${g}-transition`}),T=pe(0),y=W(void 0),I=u(()=>s.items.value.findIndex(V=>s.selected.value.includes(V.id)));Pe(I,(V,c)=>{const g=s.items.value.length,_=g-1;g<=2?f.value=V<c:V===_&&c===0?f.value=!0:V===0&&c===_?f.value=!1:f.value=V<c}),nt(Ne,{transition:p,isReversed:f,transitionCount:T,transitionHeight:y,rootRef:w});const $=X(()=>e.continuous||I.value!==0),P=X(()=>e.continuous||I.value!==s.items.value.length-1);function M(){$.value&&s.prev()}function B(){P.value&&s.next()}const D=u(()=>{const V=[],c={icon:n.value?e.nextIcon:e.prevIcon,class:`v-window__${v.value?"right":"left"}`,onClick:s.prev,"aria-label":l("$vuetify.carousel.prev")};V.push($.value?o.prev?o.prev({props:c}):r(A,c,null):i("div",null,null));const g={icon:n.value?e.prevIcon:e.nextIcon,class:`v-window__${v.value?"left":"right"}`,onClick:s.next,"aria-label":l("$vuetify.carousel.next")};return V.push(P.value?o.next?o.next({props:g}):r(A,g,null):i("div",null,null)),V}),O=u(()=>e.touch===!1?e.touch:{...{left:()=>{v.value?M():B()},right:()=>{v.value?B():M()},start:c=>{let{originalEvent:g}=c;g.stopPropagation()}},...e.touch===!0?{}:e.touch});return Q(()=>Ee(r(e.tag,{ref:w,class:N(["v-window",{"v-window--show-arrows-on-hover":e.showArrows==="hover","v-window--vertical-arrows":!!e.verticalArrows},a.value,e.class]),style:be(e.style)},{default:()=>[i("div",{class:"v-window__container",style:{height:y.value}},[o.default?.({group:s}),e.showArrows!==!1&&i("div",{class:N(["v-window__controls",{"v-window__controls--left":e.verticalArrows==="left"||e.verticalArrows===!0},{"v-window__controls--right":e.verticalArrows==="right"}])},[D.value])]),o.additional?.({group:s})]}),[[ke,O.value]])),{group:s}}}),lo=J({...Re(Ge(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VTabsWindow"),io=q()({name:"VTabsWindow",props:lo(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const a=De(_e,null),n=Oe(e,"modelValue"),l=u({get(){return n.value!=null||!a?n.value:a.items.value.find(s=>a.selected.value.includes(s.id))?.value},set(s){n.value=s}});return Q(()=>{const s=we.filterProps(e);return r(we,K({_as:"VTabsWindow"},s,{modelValue:l.value,"onUpdate:modelValue":w=>l.value=w,class:["v-tabs-window",e.class],style:e.style,mandatory:!1,touch:!1}),o)}),{}}}),ze=J({reverseTransition:{type:[Boolean,String],default:void 0},transition:{type:[Boolean,String],default:void 0},...We(),...ct(),...jt()},"VWindowItem"),ae=q()({name:"VWindowItem",directives:{vTouch:ke},props:ze(),emits:{"group:selected":e=>!0},setup(e,t){let{slots:o}=t;const a=De(Ne),n=lt(e,Fe),{isBooted:l}=it();if(!a||!n)throw new Error("[Vuetify] VWindowItem must be used inside VWindow");const s=pe(!1),w=u(()=>l.value&&(a.isReversed.value?e.reverseTransition!==!1:e.transition!==!1));function v(){!s.value||!a||(s.value=!1,a.transitionCount.value>0&&(a.transitionCount.value-=1,a.transitionCount.value===0&&(a.transitionHeight.value=void 0)))}function f(){s.value||!a||(s.value=!0,a.transitionCount.value===0&&(a.transitionHeight.value=ye(a.rootRef.value?.clientHeight)),a.transitionCount.value+=1)}function p(){v()}function T($){s.value&&dt(()=>{!w.value||!s.value||!a||(a.transitionHeight.value=ye($.clientHeight))})}const y=u(()=>{const $=a.isReversed.value?e.reverseTransition:e.transition;return w.value?{name:typeof $!="string"?a.transition.value:$,onBeforeEnter:f,onAfterEnter:v,onEnterCancelled:p,onBeforeLeave:f,onAfterLeave:v,onLeaveCancelled:p,onEnter:T}:!1}),{hasContent:I}=Ht(e,n.isSelected);return Q(()=>r(ut,{transition:y.value,disabled:!l.value},{default:()=>[Ee(i("div",{class:N(["v-window-item",n.selectedClass.value,e.class]),style:be(e.style)},[I.value&&o.default?.()]),[[rt,n.isSelected.value]])]})),{groupItem:n}}}),ro=J({...ze()},"VTabsWindowItem"),uo=q()({name:"VTabsWindowItem",props:ro(),setup(e,t){let{slots:o}=t;return Q(()=>{const a=ae.filterProps(e);return r(ae,K({_as:"VTabsWindowItem"},a,{class:["v-tabs-window-item",e.class],style:e.style}),o)}),{}}});function co(e){return e?e.map(t=>yt(t)?t:{text:t,value:t}):[]}const vo=J({alignTabs:{type:String,default:"start"},color:String,fixedTabs:Boolean,items:{type:Array,default:()=>[]},stacked:Boolean,bgColor:String,grow:Boolean,height:{type:[Number,String],default:void 0},hideSlider:Boolean,sliderColor:String,...Xt({mandatory:"force",selectedClass:"v-tab-item--selected"}),...pt(),...Ae()},"VTabs"),fo=q()({name:"VTabs",props:vo(),emits:{"update:modelValue":e=>!0},setup(e,t){let{attrs:o,slots:a}=t;const n=Oe(e,"modelValue"),l=u(()=>co(e.items)),{densityClasses:s}=vt(e),{backgroundColorClasses:w,backgroundColorStyles:v}=ft(()=>e.bgColor),{scopeId:f}=mt();return ht({VTab:{color:X(()=>e.color),direction:X(()=>e.direction),stacked:X(()=>e.stacked),fixed:X(()=>e.fixedTabs),sliderColor:X(()=>e.sliderColor),hideSlider:X(()=>e.hideSlider)}}),Q(()=>{const p=xe.filterProps(e),T=!!(a.window||e.items.length>0);return i(Y,null,[r(xe,K(p,{modelValue:n.value,"onUpdate:modelValue":y=>n.value=y,class:["v-tabs",`v-tabs--${e.direction}`,`v-tabs--align-tabs-${e.alignTabs}`,{"v-tabs--fixed-tabs":e.fixedTabs,"v-tabs--grow":e.grow,"v-tabs--stacked":e.stacked},s.value,w.value,e.class],style:[{"--v-tabs-height":ye(e.height)},v.value,e.style],role:"tablist",symbol:_e},f,o),{default:()=>[a.default?.()??l.value.map(y=>a.tab?.({item:y})??r(de,K(y,{key:y.text,value:y.value}),{default:a[`tab.${y.value}`]?()=>a[`tab.${y.value}`]?.({item:y}):void 0}))]}),T&&r(io,K({modelValue:n.value,"onUpdate:modelValue":y=>n.value=y,key:"tabs-window"},f),{default:()=>[l.value.map(y=>a.item?.({item:y})??r(uo,{value:y.value},{default:()=>a[`item.${y.value}`]?.({item:y})})),a.window?.()]})])}),{}}}),mo={class:"d-inline-block"},ho={class:"overflow-hidden text-white"},po={class:"title relative inline-block"},yo=["innerHTML"],go={key:1},ko=["innerHTML"],wo={key:0},bo={key:1},_o={key:2},Vo={key:3},To={class:"table-fixed"},$o={class:"w-1/3"},Co={class:"text-center"},xo=["title"],So={class:"text-center"},Io=["title"],Bo={class:"text-center"},Ro=["title"],Mo={class:"text-center"},Po=["title"],Eo={class:"text-center"},Ao=["title"],Wo={class:"text-right"},Do={class:"text-right"},Oo={class:"text-right"},Lo={class:"text-right"},Uo={class:"text-right"},Ho={class:"text-right"},jo={class:"text-right"},Xo={class:"text-right"},Yo={class:"text-right"},No={class:"text-right"},Fo=se({__name:"Ticket",props:{ticket:{}},setup(e){gt(h=>({"0c560d15":$e.value.delay,"2b070e7c":$e.value.duration}));const t=e,{t:o}=kt(),a=u(()=>Ce().props.factors),n=W(null),l=new St({linkify:!0}).use(It),s=He(),w=je(),v=u(()=>Ce().props.options),f=u(()=>te(t.ticket.created_at)),p=u(()=>te.duration(t.ticket.delay,"s")),T=u(()=>f.value.add(p.value)),y=u(()=>t.ticket.bound_at?te(t.ticket.bound_at):null),I=u(()=>t.ticket.reservation?te.duration(t.ticket.reservation,"s"):null),$=u(()=>y.value&&I.value?y.value.add(I.value):null),P=u(()=>t.ticket.accepted_at?te(t.ticket.accepted_at):null),M=u(()=>`${f.value.format("lll")} (${f.value.fromNow()})`),B=u(()=>`${T.value.format("lll")} (${o("time_left",{time:T.value.fromNow(!0)})})`),D=u(()=>y.value?`${y.value.format("lll")} (${y.value.fromNow()})`:null),O=u(()=>$.value?`${$.value.format("lll")} (${o("time_left",{time:$.value.fromNow(!0)})})`:null),V=u(()=>P.value?`${P.value.format("lll")} (${P.value.fromNow()})`:null),c=u(()=>`${C(t.ticket.weight)} (${o("increment_per_second",{units:t.ticket.weight_increment.toString()})})`),g=u(()=>v.value[`${w.value}_threshold`]),_=u(()=>t.ticket[w.value]),C=h=>h<1e5?h:h.toExponential(1),H=()=>t.ticket.meta?.category_name??t.ticket.category?.name??"",ee=()=>t.ticket.meta?.category_short??t.ticket.category?.short??"",ve=()=>s.altInfo?t.ticket.meta?.title??ee():ee(),fe=u(()=>t.ticket.meta?.card_title??"Title"),ie=u(()=>t.ticket.meta?.card_subtitle??H()),me=u(()=>t.ticket.meta?.card_content??[]),Ke=u(()=>_.value>g.value),$e=u(()=>({delay:-_.value+"s",duration:g.value+"s"}));return(h,j)=>(k(),x("div",mo,[r(A,{size:"small",class:N(["ticket justify-start px-2",{overflow:Ke.value}]),ripple:!1,flat:"",width:"100"},{default:m(()=>[h.ticket.meta?.icon?(k(),R(Le,{key:0,icon:h.ticket.meta?.icon??"",color:"white"},null,8,["icon"])):F("",!0),i("span",ho,[i("span",po,d(ve()),1)]),r(Yt,{"open-on-click":"",activator:"parent","location-strategy":"connected",location:"bottom center",origin:"auto"},{default:m(()=>[r(Nt,{width:"500","prepend-icon":h.ticket.meta?.icon??"",title:fe.value,subtitle:ie.value},{default:m(()=>[r(fo,{modelValue:n.value,"onUpdate:modelValue":j[0]||(j[0]=E=>n.value=E)},{default:m(()=>[r(de,{value:"properties"},{default:m(()=>[S(d(h.$t("properties")),1)]),_:1}),r(de,{value:"metrics"},{default:m(()=>[S(d(h.$t("metrics")),1)]),_:1}),r(de,{value:"details"},{default:m(()=>[S(d(h.$t("details")),1)]),_:1})]),_:1},8,["modelValue"]),r(Ft,null,{default:m(()=>[r(we,{modelValue:n.value,"onUpdate:modelValue":j[1]||(j[1]=E=>n.value=E)},{default:m(()=>[r(ae,{value:"properties",class:"prose"},{default:m(()=>[typeof me.value=="string"?(k(),x("div",{key:0,innerHTML:b(l).render(me.value)},null,8,yo)):(k(),x("table",go,[i("tbody",null,[(k(!0),x(Y,null,ne(me.value,([E,re])=>(k(),x("tr",{key:E},[i("th",null,d(E),1),i("td",{innerHTML:b(l).renderInline(re)},null,8,ko)]))),128))])]))]),_:1}),r(ae,{value:"metrics",class:"prose"},{default:m(()=>[i("table",null,[i("tbody",null,[i("tr",null,[i("th",null,d(h.$t("issued_on")),1),i("td",null,d(M.value),1)]),T.value.isAfter(h.$dayjs())?(k(),x("tr",wo,[i("th",null,d(h.$t("delayed_until")),1),i("td",null,d(B.value),1)])):F("",!0),y.value?(k(),x("tr",bo,[i("th",null,d(h.$t("bound_at")),1),i("td",null,d(D.value),1)])):F("",!0),$.value&&$.value.isAfter(h.$dayjs())?(k(),x("tr",_o,[i("th",null,d(h.$t("reserved_until")),1),i("td",null,d(O.value),1)])):F("",!0),P.value?(k(),x("tr",Vo,[i("th",null,d(h.$t("accepted_at")),1),i("td",null,d(V.value),1)])):F("",!0),i("tr",null,[i("th",null,d(h.$t("current_weight")),1),i("td",null,d(c.value),1)]),i("tr",null,[i("th",null,d(h.$t("complexity")),1),i("td",null,d(h.ticket.complexity+" "+b(o)("units")),1)])])])]),_:1}),r(ae,{value:"details",class:"prose"},{default:m(()=>[i("table",To,[i("thead",null,[i("tr",null,[i("th",$o,d(h.$t("factor")),1),i("th",Co,[i("em",{class:"metric",title:h.$t("initial_weight")},j[2]||(j[2]=[S("W",-1),i("sub",null,"0",-1)]),8,xo)]),i("th",So,[i("em",{class:"metric",title:h.$t("weight_increment")},j[3]||(j[3]=[S("W",-1),i("sub",null,"i",-1)]),8,Io)]),i("th",Bo,[i("em",{class:"metric",title:h.$t("complexity")},"C",8,Ro)]),i("th",Mo,[i("em",{class:"metric",title:h.$t("delay_sec")},"D",8,Po)]),i("th",Eo,[i("em",{class:"metric",title:h.$t("reservation_sec")},"R",8,Ao)])])]),i("tbody",null,[(k(!0),x(Y,null,ne(h.ticket.metrics??{},(E,re)=>(k(),x("tr",{key:re},[i("th",null,d(a.value[re]?.name??h.$t("unknown")),1),i("td",Wo,d(E.initial_weight??0),1),i("td",Do,d(E.weight_increment??0),1),i("td",Oo,d(E.complexity??0),1),i("td",Lo,d(E.delay??0),1),i("td",Uo,d(E.reservation??0),1)]))),128))]),i("tfoot",null,[i("tr",null,[i("th",null,d(h.$t("total")),1),i("td",Ho,d(h.ticket.initial_weight),1),i("td",jo,d(h.ticket.weight_increment),1),i("td",Xo,d(h.ticket.complexity),1),i("td",Yo,d(h.ticket.delay),1),i("td",No,d(h.ticket.reservation),1)])])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["prepend-icon","title","subtitle"])]),_:1})]),_:1},8,["class"])]))}}),Go=le(Fo,[["__scopeId","data-v-8c1a37e4"]]),zo=se({__name:"TicketPool",props:{tickets:{}},setup(e){const t=W(null);qt(t,"uuid");const{lock:o,unlock:a,element:n,triggerElement:l}=Rt(t),{x:s}=Bt({type:"movement"});u(()=>oe(Xe)),Pe([n,s],([v,f])=>{!v||!l.value||l.value.dataset.uuid});const w=W(!1);return Ue(()=>{setTimeout(()=>w.value=!0,500)}),(v,f)=>(k(),R(b(Be),{ref_key:"ticketPool",ref:t,name:"ticket-pool",class:"tickets @container !pt-[1px] !pb-[3px] leading-8",css:w.value,onMouseup:b(a)},{default:m(()=>[(k(!0),x(Y,null,ne(v.tickets,p=>(k(),R(Go,{key:p.uuid,"data-uuid":p.uuid,ticket:p,draggable:"true",class:"mr-1",onMousedown:wt(b(o),["ctrl"])},null,8,["data-uuid","ticket","onMousedown"]))),128))]),_:1},8,["css","onMouseup"]))}}),Zo=le(zo,[["__scopeId","data-v-1fd3da22"]]);function Ve(){async function e(n,l){return await window.axios.patch(ue("ticket-allocator.operators.ready",n),{ready:l})}async function t(n,l){return await window.axios.patch(ue("ticket-allocator.tickets.weight",n),{weight_points:l})}async function o(n,l){return await window.axios.patch(ue("ticket-allocator.tickets.handler",n),{operator_uuid:l??null})}async function a(n){return await window.axios.delete(ue("ticket-allocator.tickets.close",n))}return{ready:e,weight:t,handler:o,close:a}}const Ko=se({__name:"TicketRow",props:{tickets:{},pool:{type:Boolean}},setup(e){const t=e;let o=W(!1);const a=u(()=>t.pool?"th":"td"),n=u(()=>t.tickets.reduce((f,{complexity:p})=>f+p,0)),l=u(()=>o.value?"mdi-chevron-down":"mdi-chevron-up"),s=Ve(),w=W(null),{isOverDropZone:v}=Ye(w,async f=>{const p=f?.getData("text/plain");if(!p)throw new Error("Ticket UUID undefined.");const T=w.value?.dataset.uuid;return await s.handler(p,T)},!1);return(f,p)=>(k(),x("tr",{ref_key:"ticketRow",ref:w,class:N(["ticket-row",{dragover:b(v)}])},[(k(),R(z(a.value),{class:"status py-1"},{default:m(()=>[G(f.$slots,"status",{},void 0,!0)]),_:3})),(k(),R(z(a.value),{class:"name font-weight-bold !pt-[6px]"},{default:m(()=>[G(f.$slots,"name",{},void 0,!0)]),_:3})),(k(),R(z(a.value),{class:"load !pt-[6px] text-center"},{default:m(()=>[G(f.$slots,"load",{},()=>[S(d(f.tickets.length),1)],!0),p[2]||(p[2]=S("/",-1)),G(f.$slots,"load-max",{},()=>[p[1]||(p[1]=S("∞",-1))],!0)]),_:3,__:[2]})),(k(),R(z(a.value),{class:"complexity !pt-[6px] text-center"},{default:m(()=>[G(f.$slots,"complexity",{},()=>[S(d(n.value),1)],!0),p[4]||(p[4]=S("/",-1)),G(f.$slots,"complexity-max",{},()=>[p[3]||(p[3]=S("∞",-1))],!0)]),_:3,__:[4]})),r(Zo,{tag:a.value,tickets:f.tickets,class:N({collapsed:b(o)})},null,8,["tag","tickets","class"]),(k(),R(z(a.value),{class:"more !pt-[2px] text-center"},{default:m(()=>[r(A,{size:"x-small",variant:"tonal",icon:l.value,onClick:p[0]||(p[0]=T=>ge(o)?o.value=!b(o):o=!b(o))},null,8,["icon"])]),_:1}))],2))}}),Ze=le(Ko,[["__scopeId","data-v-113cb187"]]),qo=se({__name:"OperatorRow",props:{operator:{}},setup(e){const t=e,o=u(()=>({online:t.operator.online,ready:t.operator.ready,busy:!!t.operator.tickets?.length,full:t.operator.ticket_limit!==null&&t.operator.tickets?.length>=t.operator.ticket_limit})),a=Ve(),n=async()=>await a.ready(t.operator.uuid,!t.operator.ready);return(l,s)=>(k(),R(Ze,{tickets:l.operator.tickets,"data-uuid":l.operator.uuid,class:N(["operator",o.value])},{status:m(()=>[r(Le,{icon:"mdi-account",onClick:n})]),"load-max":m(()=>[S(d(l.operator.ticket_limit??"∞"),1)]),"complexity-max":m(()=>[S(d(l.operator.complexity_limit??"∞"),1)]),name:m(()=>[S(d(l.operator.name),1)]),_:1},8,["tickets","data-uuid","class"]))}}),Jo=le(qo,[["__scopeId","data-v-a776c74a"]]);function Qo(e,t){return e.reduce((o,a)=>(typeof a[t]=="number"&&(o+=a[t]),o),0)}function Te(e,t){return e.map(o=>_t(o,t)).filter(o=>o)}function ea(e,t){const o=Te(e,t).filter(a=>typeof a=="number");return o.length===0?0:Math.max(...o)}function ta(e,t){const o=Te(e,t).filter(a=>typeof a=="number");return o.length===0?0:Math.min(...o)}function oa(e){return e.map(t=>t[t.$getLocalKey()])}function aa(e,t){const o={},a=Array.isArray(t)?t:[t];return e.forEach(n=>{const l=a.length===1?n[a[0]]:`[${a.map(s=>n[s]).toString()}]`;o[l]=(o[l]||[]).concat(n)}),o}function na(e,t,o){const a=[],n=[];return typeof t=="function"&&n.push(t)&&a.push("asc"),Array.isArray(t)&&t.forEach(l=>n.push(l[0])&&a.push(l[1])),n.length===0&&n.push(t),bt(e,n,a,o)}function sa(e){return{sum:t=>Qo(e,t),min:t=>ta(e,t),max:t=>ea(e,t),pluck:t=>Te(e,t),groupBy:t=>aa(e,t),sortBy:(t,o="SORT_REGULAR")=>na(e,t,o),keys:()=>oa(e)}}const la={class:"text-xl leading-tight font-semibold text-gray-800"},ia={class:"align-top"},ra=se({__name:"Dashboard",props:{layout:{default:"default"},operators:{},operatorTeams:{},tickets:{},ticketCategories:{},factors:{},matchers:{}},setup(e){const t=e,o=He(),a=je(),n=Mt(),l=Pt(),s=u(()=>oe(Dt)),w=u(()=>oe(Ot)),v=u(()=>oe(Xe)),f=u(()=>oe(Lt)),p=Et(Ut),T=c=>Object.entries(n.value).reduce((g,[_,C])=>{const H=c?.[_],ee=H===void 0||!C.length||C.map(String).includes(H.toString());return g&&ee},!0),y=u(()=>sa(s.value.with("teams").with("tickets",c=>{c.with("category").where("meta",T).orderBy(a.value,"desc")}).whereHas("tickets").orWhere(c=>!o.hideEmpty&&c.online).get().filter(c=>!l.value.length||c.teams.some(g=>l.value.includes(g.uuid)))).sortBy([["online","desc"],["ready","desc"],["free_slots","desc"],["ticket_count","asc"],["name","asc"]])),I=u(()=>v.value.unbound().with("category").where("meta",T).orderBy(a.value,"desc").get()),$=Ve(),P=W(null),{isOverDropZone:M}=Ye(P,async c=>{const g=c?.getData("text/plain");if(!g)throw new Error("Ticket UUID undefined.");return await $.close(g)},!1);Ue(()=>{p.listen(At.PropsInvalidated,()=>he.reload()).listen(L.Enrolled,s.value.enroll).listen(L.Resigned,s.value.resign).listen(L.NameChanged,s.value.changeName).listen(L.Online,s.value.setOnline).listen(L.Offline,s.value.setOffline).listen(L.Ready,s.value.setReady).listen(L.NotReady,s.value.setNotReady).listen(L.TicketLimitAdjusted,s.value.adjustTicketLimit).listen(L.ComplexityLimitAdjusted,s.value.adjustComplexityLimit).listen(U.Created,v.value.create).listen(U.Closed,v.value.close).listen(U.Bound,v.value.bind).listen(U.Accepted,v.value.accept).listen(U.Unbound,v.value.unbind).listen(U.CategoryChanged,v.value.changeCategory).listen(U.MetaValueSet,v.value.setMetaValue).listen(U.MetaValuesMerged,v.value.mergeMetaValues).listen(U.MetricsAdjusted,v.value.adjustMetrics)});function B(){s.value.save(t.operators),w.value.fresh(t.operatorTeams),v.value.fresh(t.tickets),f.value.fresh(t.ticketCategories)}const D=he.on("navigate",B),O=he.on("success",B);Vt(()=>{D(),O()});const V=c=>Object.entries(c).map(([g,_])=>({title:g,value:_}));return(c,g)=>(k(),x(Y,null,[r(b(Tt),{title:c.$t("dashboard")},null,8,["title"]),(k(),R(z(`${c.layout}-layout`),null,{header:m(()=>[i("h2",la,d(c.$t("dashboard")),1)]),default:m(()=>[i("div",null,[r(Zt,{fluid:""},{default:m(()=>[r(Se,null,{default:m(()=>[r(ce,null,{default:m(()=>[r($t,{modelValue:b(o).all,"onUpdate:modelValue":g[0]||(g[0]=_=>b(o).all=_),variant:"plain",multiple:""},{default:m(()=>[r(A,{value:"show-filters",icon:b(o).showFilters?"mdi-filter-outline":"mdi-filter-off-outline"},null,8,["icon"]),r(A,{value:"hide-empty",icon:b(o).hideEmpty?"mdi-eye-off-outline":"mdi-eye-outline"},null,8,["icon"]),r(A,{value:"alt-info",icon:b(o).altInfo?"mdi-magnify-plus-outline":"mdi-magnify"},null,8,["icon"]),r(A,{value:"unlocked",icon:b(o).unlocked?"mdi-lock-open-variant":"mdi-lock",color:"red",variant:b(o).unlocked?"text":"plain"},null,8,["icon","variant"])]),_:1},8,["modelValue"]),b(o).unlocked?(k(),R(Ct,{key:0,variant:"plain"},{default:m(()=>[r(A,{ref_key:"closeTicket",ref:P,icon:b(M)?"mdi-delete-empty":"mdi-delete"},null,8,["icon"]),r(A,{icon:"mdi-refresh"})]),_:1})):F("",!0)]),_:1}),r(ce,{cols:"2"},{default:m(()=>[r(Wt,{modelValue:b(a),"onUpdate:modelValue":g[1]||(g[1]=_=>ge(a)?a.value=_:null),"false-value":"weight","true-value":"duration","prepend-icon":"mdi-weight","append-icon":"mdi-clock",class:"d-flex justify-end"},null,8,["modelValue"])]),_:1})]),_:1}),b(o).showFilters?(k(),R(Se,{key:0},{default:m(()=>[r(ce,{cols:"2"},{default:m(()=>[r(Ie,{modelValue:b(l),"onUpdate:modelValue":g[2]||(g[2]=_=>ge(l)?l.value=_:null),multiple:"",clearable:"",chips:"","closable-chips":"",label:c.$t("teams"),items:c.operatorTeams,"item-title":"name","item-value":"uuid"},null,8,["modelValue","label","items"])]),_:1}),(k(!0),x(Y,null,ne(c.matchers,(_,C)=>(k(),R(ce,{key:C,cols:"2"},{default:m(()=>[r(Ie,{modelValue:b(n)[C],"onUpdate:modelValue":H=>b(n)[C]=H,multiple:"",clearable:"",chips:"","closable-chips":"",label:c.$t(C),items:V(_)},null,8,["modelValue","onUpdate:modelValue","label","items"])]),_:2},1024))),128))]),_:1})):F("",!0)]),_:1}),r(Kt,{"fixed-header":"",height:"600px",density:"compact",class:"ticket-monitor"},{default:m(()=>[i("thead",ia,[r(Ze,{pool:"",tickets:I.value},{name:m(()=>[S(d(c.$t("ticket_pool")),1)]),_:1},8,["tickets"])]),r(b(Be),{tag:"tbody",class:"align-top",name:"operator-pool"},{default:m(()=>[(k(!0),x(Y,null,ne(y.value,_=>(k(),R(Jo,{key:_.uuid,operator:_},null,8,["operator"]))),128))]),_:1})]),_:1})])]),_:1}))],64))}}),Va=le(ra,[["__scopeId","data-v-811338dd"]]);export{Va as default};
//# sourceMappingURL=Dashboard-BaygHK3B.js.map
