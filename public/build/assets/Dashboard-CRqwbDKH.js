import{T as Be}from"./TransitionGroup-CYHCIdAJ.js";import{r as D,g as q,p as J,u as Je,c as u,a as Q,V as A,b as r,d as l,n as be,e as N,F as Y,m as K,o as Re,f as Qe,s as et,k as Ee,h as tt,i as at,j as ot,l as nt,q as ge,w as Me,t as st,v as X,x as Pe,y as ve,P as lt,z as it,A as Ae,B as De,C as Oe,D as We,E as rt,G as ut,H as ct,M as dt,I as vt,J as ft,K as mt,L as ht,N as yt,O as gt,Q as kt,R as pt,S as wt,T as se,U as bt,W as _t,X as $e,Y as te,Z as C,_ as k,$ as f,a0 as R,a1 as F,a2 as Le,a3 as c,a4 as S,a5 as w,a6 as ne,a7 as le,a8 as ae,a9 as Ue,aa as xt,ab as ue,ac as z,ad as G,ae as ke,af as Vt,ag as Tt,ah as ye,ai as $t,aj as Ct,ak as St,al as It}from"./app-D-yat15h.js";import{u as Z,i as Bt,M as Rt,a as Et,b as He,c as je,d as Mt,e as Pt,T as Xe,f as At,g as Dt,h as Ot,C as Wt,O as L,j as U,V as Lt,k as Ut,l as Ht,m as jt,n as Xt}from"./VSwitch-CRXNt4Cn.js";import{u as Yt,m as Nt,V as Ce,a as Ft,b as Gt}from"./filter-HBd77JfG.js";import{V as zt,a as Zt}from"./VCard-Cn7TIGHX.js";import{f as Kt}from"./VInput-DeaR9ABf.js";import{a as qt}from"./VTextField-B0vtNHdP.js";import{V as Jt}from"./VContainer-CLUMNoaL.js";import{V as Se,a as ce}from"./VRow-DjxzB2QN.js";import{V as Ie}from"./VAutocomplete-DHgHim2l.js";import{V as Qt}from"./VTable-Bf2D3x30.js";import"./VSelectionControl-Dab1E8ss.js";import"./VCheckboxBtn-B9CfyC32.js";/* empty css              */function ea(e,t){const a=D();return Z(e,"dragstart",o=>{if(a.value=o.target,typeof t=="string"){const n=t;t=(i,s)=>{s?.setData("text/plain",i.dataset[n]??"")}}t?.(a.value,o.dataTransfer)}),Z(e,"dragend",()=>{a.value=null}),{element:a}}function Ye(e,t,a=!0){const o=D(!1);let n=0;return Bt&&(Z(e,"dragenter",i=>{i.preventDefault(),n++,o.value=!0}),Z(e,"dragover",i=>{i.preventDefault()}),Z(e,"dragleave",i=>{i.preventDefault(),n--,n===0&&(o.value=!1)}),Z(e,"drop",i=>{if(i.preventDefault(),n=0,o.value=!1,t)if(a){const s=Array.from(i.dataTransfer?.files??[]);t(s.length===0?null:s)}else t(i.dataTransfer)})),{isOverDropZone:o}}const _e=Symbol.for("vuetify:v-tabs"),Ne=J({fixed:Boolean,sliderColor:String,hideSlider:Boolean,direction:{type:String,default:"horizontal"},...Re(Qe({selectedClass:"v-tab--selected",variant:"text"}),["active","block","flat","location","position","symbol"])},"VTab"),de=q()({name:"VTab",props:Ne(),setup(e,t){let{slots:a,attrs:o}=t;const{textColorClasses:n,textColorStyles:i}=Je(()=>e.sliderColor),s=D(),p=D(),d=u(()=>e.direction==="horizontal"),m=u(()=>s.value?.group?.isSelected.value??!1);function h(V){let{value:y}=V;if(y){const I=s.value?.$el.parentElement?.querySelector(".v-tab--selected .v-tab__slider"),T=p.value;if(!I||!T)return;const M=getComputedStyle(I).color,E=I.getBoundingClientRect(),B=T.getBoundingClientRect(),O=d.value?"x":"y",W=d.value?"X":"Y",x=d.value?"right":"bottom",v=d.value?"width":"height",g=E[O],_=B[O],$=g>_?E[x]-B[x]:E[O]-B[O],H=Math.sign($)>0?d.value?"right":"bottom":Math.sign($)<0?d.value?"left":"top":"center",fe=(Math.abs($)+(Math.sign($)<0?E[v]:B[v]))/Math.max(E[v],B[v])||0,me=E[v]/B[v]||0,ie=1.5;qt(T,{backgroundColor:[M,"currentcolor"],transform:[`translate${W}(${$}px) scale${W}(${me})`,`translate${W}(${$/ie}px) scale${W}(${(fe-1)/ie+1})`,"none"],transformOrigin:Array(3).fill(H)},{duration:225,easing:et})}}return Q(()=>{const V=A.filterProps(e);return r(A,K({symbol:_e,ref:s,class:["v-tab",e.class],style:e.style,tabindex:m.value?0:-1,role:"tab","aria-selected":String(m.value),active:!1},V,o,{block:e.fixed,maxWidth:e.fixed?300:void 0,"onGroup:selected":h}),{...a,default:()=>l(Y,null,[a.default?.()??e.text,!e.hideSlider&&l("div",{ref:p,class:N(["v-tab__slider",n.value]),style:be(i.value)},null)])})}),Kt({},s)}}),ta=e=>{const{touchstartX:t,touchendX:a,touchstartY:o,touchendY:n}=e,i=.5,s=16;e.offsetX=a-t,e.offsetY=n-o,Math.abs(e.offsetY)<i*Math.abs(e.offsetX)&&(e.left&&a<t-s&&e.left(e),e.right&&a>t+s&&e.right(e)),Math.abs(e.offsetX)<i*Math.abs(e.offsetY)&&(e.up&&n<o-s&&e.up(e),e.down&&n>o+s&&e.down(e))};function aa(e,t){const a=e.changedTouches[0];t.touchstartX=a.clientX,t.touchstartY=a.clientY,t.start?.({originalEvent:e,...t})}function oa(e,t){const a=e.changedTouches[0];t.touchendX=a.clientX,t.touchendY=a.clientY,t.end?.({originalEvent:e,...t}),ta(t)}function na(e,t){const a=e.changedTouches[0];t.touchmoveX=a.clientX,t.touchmoveY=a.clientY,t.move?.({originalEvent:e,...t})}function sa(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={touchstartX:0,touchstartY:0,touchendX:0,touchendY:0,touchmoveX:0,touchmoveY:0,offsetX:0,offsetY:0,left:e.left,right:e.right,up:e.up,down:e.down,start:e.start,move:e.move,end:e.end};return{touchstart:a=>aa(a,t),touchend:a=>oa(a,t),touchmove:a=>na(a,t)}}function la(e,t){const a=t.value,o=a?.parent?e.parentElement:e,n=a?.options??{passive:!0},i=t.instance?.$.uid;if(!o||i===void 0)return;const s=sa(t.value);o._touchHandlers=o._touchHandlers??Object.create(null),o._touchHandlers[i]=s,Ee(s).forEach(p=>{o.addEventListener(p,s[p],n)})}function ia(e,t){const a=t.value?.parent?e.parentElement:e,o=t.instance?.$.uid;if(!a?._touchHandlers||o===void 0)return;const n=a._touchHandlers[o];Ee(n).forEach(i=>{a.removeEventListener(i,n[i])}),delete a._touchHandlers[o]}const pe={mounted:la,unmounted:ia},Fe=Symbol.for("vuetify:v-window"),Ge=Symbol.for("vuetify:v-window-group"),ze=J({continuous:Boolean,nextIcon:{type:[Boolean,String,Function,Object],default:"$next"},prevIcon:{type:[Boolean,String,Function,Object],default:"$prev"},reverse:Boolean,showArrows:{type:[Boolean,String],validator:e=>typeof e=="boolean"||e==="hover"},verticalArrows:[Boolean,String],touch:{type:[Object,Boolean],default:void 0},direction:{type:String,default:"horizontal"},modelValue:null,disabled:Boolean,selectedClass:{type:String,default:"v-window-item--active"},mandatory:{type:[Boolean,String],default:"force"},crossfade:Boolean,transitionDuration:Number,...De(),...Ae(),...it()},"VWindow"),we=q()({name:"VWindow",directives:{vTouch:pe},props:ze(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:a}=t;const{themeClasses:o}=tt(e),{isRtl:n}=at(),{t:i}=ot(),s=nt(e,Ge),p=D(),d=u(()=>n.value?!e.reverse:e.reverse),m=ge(!1),h=u(()=>{if(e.crossfade)return"v-window-crossfade-transition";const x=e.direction==="vertical"?"y":"x",g=(d.value?!m.value:m.value)?"-reverse":"";return`v-window-${x}${g}-transition`}),V=ge(0),y=D(void 0),I=u(()=>s.items.value.findIndex(x=>s.selected.value.includes(x.id)));Me(I,(x,v)=>{const g=s.items.value.length,_=g-1;g<=2?m.value=x<v:x===_&&v===0?m.value=!0:x===0&&v===_?m.value=!1:m.value=x<v}),st(Fe,{transition:h,isReversed:m,transitionCount:V,transitionHeight:y,rootRef:p});const T=X(()=>e.continuous||I.value!==0),M=X(()=>e.continuous||I.value!==s.items.value.length-1);function E(){T.value&&s.prev()}function B(){M.value&&s.next()}const O=u(()=>{const x=[],v={icon:n.value?e.nextIcon:e.prevIcon,class:`v-window__${d.value?"right":"left"}`,onClick:s.prev,"aria-label":i("$vuetify.carousel.prev")};x.push(T.value?a.prev?a.prev({props:v}):r(A,v,null):l("div",null,null));const g={icon:n.value?e.prevIcon:e.nextIcon,class:`v-window__${d.value?"left":"right"}`,onClick:s.next,"aria-label":i("$vuetify.carousel.next")};return x.push(M.value?a.next?a.next({props:g}):r(A,g,null):l("div",null,null)),x}),W=u(()=>e.touch===!1?e.touch:{...{left:()=>{d.value?E():B()},right:()=>{d.value?B():E()},start:v=>{let{originalEvent:g}=v;g.stopPropagation()}},...e.touch===!0?{}:e.touch});return Q(()=>Pe(r(e.tag,{ref:p,class:N(["v-window",{"v-window--show-arrows-on-hover":e.showArrows==="hover","v-window--vertical-arrows":!!e.verticalArrows,"v-window--crossfade":!!e.crossfade},o.value,e.class]),style:be([e.style,e.transitionDuration&&!lt?{"--v-window-transition-duration":ve(e.transitionDuration,"ms")}:void 0])},{default:()=>[l("div",{class:"v-window__container",style:{height:y.value}},[a.default?.({group:s}),e.showArrows!==!1&&l("div",{class:N(["v-window__controls",{"v-window__controls--left":e.verticalArrows==="left"||e.verticalArrows===!0},{"v-window__controls--right":e.verticalArrows==="right"}])},[O.value])]),a.additional?.({group:s})]}),[[pe,W.value]])),{group:s}}}),ra=J({...Re(ze(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VTabsWindow"),ua=q()({name:"VTabsWindow",props:ra(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:a}=t;const o=Oe(_e,null),n=We(e,"modelValue"),i=u({get(){return n.value!=null||!o?n.value:o.items.value.find(s=>o.selected.value.includes(s.id))?.value},set(s){n.value=s}});return Q(()=>{const s=we.filterProps(e);return r(we,K({_as:"VTabsWindow"},s,{modelValue:i.value,"onUpdate:modelValue":p=>i.value=p,class:["v-tabs-window",e.class],style:e.style,mandatory:!1,touch:!1}),a)}),{}}}),Ze=J({reverseTransition:{type:[Boolean,String],default:void 0},transition:{type:[Boolean,String],default:void 0},...De(),...vt(),...Nt()},"VWindowItem"),oe=q()({name:"VWindowItem",directives:{vTouch:pe},props:Ze(),emits:{"group:selected":e=>!0},setup(e,t){let{slots:a}=t;const o=Oe(Fe),n=rt(e,Ge),{isBooted:i}=ut();if(!o||!n)throw new Error("[Vuetify] VWindowItem must be used inside VWindow");const s=ge(!1),p=u(()=>i.value&&(o.isReversed.value?e.reverseTransition!==!1:e.transition!==!1));function d(){!s.value||!o||(s.value=!1,o.transitionCount.value>0&&(o.transitionCount.value-=1,o.transitionCount.value===0&&(o.transitionHeight.value=void 0)))}function m(){s.value||!o||(s.value=!0,o.transitionCount.value===0&&(o.transitionHeight.value=ve(o.rootRef.value?.clientHeight)),o.transitionCount.value+=1)}function h(){d()}function V(T){s.value&&ft(()=>{!p.value||!s.value||!o||(o.transitionHeight.value=ve(T.clientHeight))})}const y=u(()=>{const T=o.isReversed.value?e.reverseTransition:e.transition;return p.value?{name:typeof T!="string"?o.transition.value:T,onBeforeEnter:m,onAfterEnter:d,onEnterCancelled:h,onBeforeLeave:m,onAfterLeave:d,onLeaveCancelled:h,onEnter:V}:!1}),{hasContent:I}=Yt(e,n.isSelected);return Q(()=>r(dt,{transition:y.value,disabled:!i.value},{default:()=>[Pe(l("div",{class:N(["v-window-item",n.selectedClass.value,e.class]),style:be(e.style)},[I.value&&a.default?.()]),[[ct,n.isSelected.value]])]})),{groupItem:n}}}),ca=J({...Ze()},"VTabsWindowItem"),da=q()({name:"VTabsWindowItem",props:ca(),setup(e,t){let{slots:a}=t;return Q(()=>{const o=oe.filterProps(e);return r(oe,K({_as:"VTabsWindowItem"},o,{class:["v-tabs-window-item",e.class],style:e.style}),a)}),{}}});function va(e){return e?e.map(t=>wt(t)?t:{text:t,value:t}):[]}const fa=J({alignTabs:{type:String,default:"start"},color:String,fixedTabs:Boolean,items:{type:Array,default:()=>[]},stacked:Boolean,bgColor:String,grow:Boolean,height:{type:[Number,String],default:void 0},hideSlider:Boolean,sliderColor:String,...pt(Ne(),["spaced"]),...Ft({mandatory:"force",selectedClass:"v-tab-item--selected"}),...kt(),...Ae()},"VTabs"),ma=q()({name:"VTabs",props:fa(),emits:{"update:modelValue":e=>!0},setup(e,t){let{attrs:a,slots:o}=t;const n=We(e,"modelValue"),i=u(()=>va(e.items)),{densityClasses:s}=mt(e),{backgroundColorClasses:p,backgroundColorStyles:d}=ht(()=>e.bgColor),{scopeId:m}=yt();return gt({VTab:{color:X(()=>e.color),direction:X(()=>e.direction),stacked:X(()=>e.stacked),fixed:X(()=>e.fixedTabs),sliderColor:X(()=>e.sliderColor),hideSlider:X(()=>e.hideSlider)}}),Q(()=>{const h=Ce.filterProps(e),V=!!(o.window||e.items.length>0);return l(Y,null,[r(Ce,K(h,{modelValue:n.value,"onUpdate:modelValue":y=>n.value=y,class:["v-tabs",`v-tabs--${e.direction}`,`v-tabs--align-tabs-${e.alignTabs}`,{"v-tabs--fixed-tabs":e.fixedTabs,"v-tabs--grow":e.grow,"v-tabs--stacked":e.stacked},s.value,p.value,e.class],style:[{"--v-tabs-height":ve(e.height)},d.value,e.style],role:"tablist",symbol:_e},m,a),{default:()=>[o.default?.()??i.value.map(y=>o.tab?.({item:y})??r(de,K(y,{key:y.text,value:y.value,spaced:e.spaced}),{default:o[`tab.${y.value}`]?()=>o[`tab.${y.value}`]?.({item:y}):void 0}))]}),V&&r(ua,K({modelValue:n.value,"onUpdate:modelValue":y=>n.value=y,key:"tabs-window"},m),{default:()=>[i.value.map(y=>o.item?.({item:y})??r(da,{value:y.value},{default:()=>o[`item.${y.value}`]?.({item:y})})),o.window?.()]})])}),{}}}),ha={class:"d-inline-block"},ya={class:"overflow-hidden text-white"},ga={class:"title relative inline-block"},ka=["innerHTML"],pa={key:1},wa=["innerHTML"],ba={key:0},_a={key:1},xa={key:2},Va={key:3},Ta={class:"table-fixed"},$a={class:"w-1/3"},Ca={class:"text-center"},Sa=["title"],Ia={class:"text-center"},Ba=["title"],Ra={class:"text-center"},Ea=["title"],Ma={class:"text-center"},Pa=["title"],Aa={class:"text-center"},Da=["title"],Oa={class:"text-right"},Wa={class:"text-right"},La={class:"text-right"},Ua={class:"text-right"},Ha={class:"text-right"},ja={class:"text-right"},Xa={class:"text-right"},Ya={class:"text-right"},Na={class:"text-right"},Fa={class:"text-right"},Ga=se({__name:"Ticket",props:{ticket:{}},setup(e){bt(b=>({v0c560d15:Te.value.delay,v2b070e7c:Te.value.duration}));const t=e,{t:a}=_t(),o=u(()=>$e().props.factors),n=D(null),i=new Rt({linkify:!0}).use(Et),s=He(),p=je(),d=u(()=>$e().props.options),m=u(()=>te(t.ticket.created_at)),h=u(()=>te.duration(t.ticket.delay,"s")),V=u(()=>m.value.add(h.value)),y=u(()=>t.ticket.bound_at?te(t.ticket.bound_at):null),I=u(()=>t.ticket.reservation?te.duration(t.ticket.reservation,"s"):null),T=u(()=>y.value&&I.value?y.value.add(I.value):null),M=u(()=>t.ticket.accepted_at?te(t.ticket.accepted_at):null),E=u(()=>`${m.value.format("lll")} (${m.value.fromNow()})`),B=u(()=>`${V.value.format("lll")} (${a("time_left",{time:V.value.fromNow(!0)})})`),O=u(()=>y.value?`${y.value.format("lll")} (${y.value.fromNow()})`:null),W=u(()=>T.value?`${T.value.format("lll")} (${a("time_left",{time:T.value.fromNow(!0)})})`:null),x=u(()=>M.value?`${M.value.format("lll")} (${M.value.fromNow()})`:null),v=u(()=>`${$(t.ticket.weight)} (${a("increment_per_second",{units:t.ticket.weight_increment.toString()})})`),g=u(()=>d.value[`${p.value}_threshold`]),_=u(()=>t.ticket[p.value]),$=b=>b<1e5?b:b.toExponential(1),H=()=>t.ticket.meta?.category_name??t.ticket.category?.name??"",ee=()=>t.ticket.meta?.category_short??t.ticket.category?.short??"",fe=()=>s.altInfo?t.ticket.meta?.title??ee():ee(),me=u(()=>t.ticket.meta?.card_title??"Title"),ie=u(()=>t.ticket.meta?.card_subtitle??H()),he=u(()=>t.ticket.meta?.card_content??[]),qe=u(()=>_.value>g.value),Te=u(()=>({delay:-_.value+"s",duration:g.value+"s"}));return(b,j)=>(k(),C("div",ha,[r(A,{size:"small",class:N(["ticket justify-start px-2",{overflow:qe.value}]),ripple:!1,flat:"",width:"100"},{default:f(()=>[e.ticket.meta?.icon?(k(),R(Le,{key:0,icon:e.ticket.meta?.icon??"",color:"white"},null,8,["icon"])):F("",!0),l("span",ya,[l("span",ga,c(fe()),1)]),r(Gt,{"open-on-click":"",activator:"parent","location-strategy":"connected",location:"bottom center",origin:"auto"},{default:f(()=>[r(zt,{width:"500","prepend-icon":e.ticket.meta?.icon??"",title:me.value,subtitle:ie.value},{default:f(()=>[r(ma,{modelValue:n.value,"onUpdate:modelValue":j[0]||(j[0]=P=>n.value=P)},{default:f(()=>[r(de,{value:"properties"},{default:f(()=>[S(c(b.$t("properties")),1)]),_:1}),r(de,{value:"metrics"},{default:f(()=>[S(c(b.$t("metrics")),1)]),_:1}),r(de,{value:"details"},{default:f(()=>[S(c(b.$t("details")),1)]),_:1})]),_:1},8,["modelValue"]),r(Zt,null,{default:f(()=>[r(we,{modelValue:n.value,"onUpdate:modelValue":j[1]||(j[1]=P=>n.value=P)},{default:f(()=>[r(oe,{value:"properties",class:"prose"},{default:f(()=>[typeof he.value=="string"?(k(),C("div",{key:0,innerHTML:w(i).render(he.value)},null,8,ka)):(k(),C("table",pa,[l("tbody",null,[(k(!0),C(Y,null,ne(he.value,([P,re])=>(k(),C("tr",{key:P},[l("th",null,c(P),1),l("td",{innerHTML:w(i).renderInline(re)},null,8,wa)]))),128))])]))]),_:1}),r(oe,{value:"metrics",class:"prose"},{default:f(()=>[l("table",null,[l("tbody",null,[l("tr",null,[l("th",null,c(b.$t("issued_on")),1),l("td",null,c(E.value),1)]),V.value.isAfter(b.$dayjs())?(k(),C("tr",ba,[l("th",null,c(b.$t("delayed_until")),1),l("td",null,c(B.value),1)])):F("",!0),y.value?(k(),C("tr",_a,[l("th",null,c(b.$t("bound_at")),1),l("td",null,c(O.value),1)])):F("",!0),T.value&&T.value.isAfter(b.$dayjs())?(k(),C("tr",xa,[l("th",null,c(b.$t("reserved_until")),1),l("td",null,c(W.value),1)])):F("",!0),M.value?(k(),C("tr",Va,[l("th",null,c(b.$t("accepted_at")),1),l("td",null,c(x.value),1)])):F("",!0),l("tr",null,[l("th",null,c(b.$t("current_weight")),1),l("td",null,c(v.value),1)]),l("tr",null,[l("th",null,c(b.$t("complexity")),1),l("td",null,c(e.ticket.complexity+" "+w(a)("units")),1)])])])]),_:1}),r(oe,{value:"details",class:"prose"},{default:f(()=>[l("table",Ta,[l("thead",null,[l("tr",null,[l("th",$a,c(b.$t("factor")),1),l("th",Ca,[l("em",{class:"metric",title:b.$t("initial_weight")},[...j[2]||(j[2]=[S("W",-1),l("sub",null,"0",-1)])],8,Sa)]),l("th",Ia,[l("em",{class:"metric",title:b.$t("weight_increment")},[...j[3]||(j[3]=[S("W",-1),l("sub",null,"i",-1)])],8,Ba)]),l("th",Ra,[l("em",{class:"metric",title:b.$t("complexity")},"C",8,Ea)]),l("th",Ma,[l("em",{class:"metric",title:b.$t("delay_sec")},"D",8,Pa)]),l("th",Aa,[l("em",{class:"metric",title:b.$t("reservation_sec")},"R",8,Da)])])]),l("tbody",null,[(k(!0),C(Y,null,ne(e.ticket.metrics??{},(P,re)=>(k(),C("tr",{key:re},[l("th",null,c(o.value[re]?.name??b.$t("unknown")),1),l("td",Oa,c(P.initial_weight??0),1),l("td",Wa,c(P.weight_increment??0),1),l("td",La,c(P.complexity??0),1),l("td",Ua,c(P.delay??0),1),l("td",Ha,c(P.reservation??0),1)]))),128))]),l("tfoot",null,[l("tr",null,[l("th",null,c(b.$t("total")),1),l("td",ja,c(e.ticket.initial_weight),1),l("td",Xa,c(e.ticket.weight_increment),1),l("td",Ya,c(e.ticket.complexity),1),l("td",Na,c(e.ticket.delay),1),l("td",Fa,c(e.ticket.reservation),1)])])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["prepend-icon","title","subtitle"])]),_:1})]),_:1},8,["class"])]))}}),za=le(Ga,[["__scopeId","data-v-8c1a37e4"]]),Za=se({__name:"TicketPool",props:{tickets:{}},setup(e){const t=D(null);ea(t,"uuid");const{lock:a,unlock:o,element:n,triggerElement:i}=Pt(t),{x:s}=Mt({type:"movement"});u(()=>ae(Xe)),Me([n,s],([d,m])=>{!d||!i.value||i.value.dataset.uuid});const p=D(!1);return Ue(()=>{setTimeout(()=>p.value=!0,500)}),(d,m)=>(k(),R(w(Be),{ref_key:"ticketPool",ref:t,name:"ticket-pool",class:"tickets @container !pt-[1px] !pb-[3px] leading-8",css:p.value,onMouseup:w(o)},{default:f(()=>[(k(!0),C(Y,null,ne(e.tickets,h=>(k(),R(za,{key:h.uuid,"data-uuid":h.uuid,ticket:h,draggable:"true",class:"mr-1",onMousedown:xt(w(a),["ctrl"])},null,8,["data-uuid","ticket","onMousedown"]))),128))]),_:1},8,["css","onMouseup"]))}}),Ka=le(Za,[["__scopeId","data-v-1fd3da22"]]);function xe(){async function e(n,i){return await window.axios.patch(ue("ticket-allocator.operators.ready",n),{ready:i})}async function t(n,i){return await window.axios.patch(ue("ticket-allocator.tickets.weight",n),{weight_points:i})}async function a(n,i){return await window.axios.patch(ue("ticket-allocator.tickets.handler",n),{operator_uuid:i??null})}async function o(n){return await window.axios.delete(ue("ticket-allocator.tickets.close",n))}return{ready:e,weight:t,handler:a,close:o}}const qa=se({__name:"TicketRow",props:{tickets:{},pool:{type:Boolean}},setup(e){const t=e;let a=D(!1);const o=u(()=>t.pool?"th":"td"),n=u(()=>t.tickets.reduce((m,{complexity:h})=>m+h,0)),i=u(()=>a.value?"mdi-chevron-down":"mdi-chevron-up"),s=xe(),p=D(null),{isOverDropZone:d}=Ye(p,async m=>{const h=m?.getData("text/plain");if(!h)throw new Error("Ticket UUID undefined.");const V=p.value?.dataset.uuid;return await s.handler(h,V)},!1);return(m,h)=>(k(),C("tr",{ref_key:"ticketRow",ref:p,class:N(["ticket-row",{dragover:w(d)}])},[(k(),R(z(o.value),{class:"status py-1"},{default:f(()=>[G(m.$slots,"status",{},void 0,!0)]),_:3})),(k(),R(z(o.value),{class:"name font-weight-bold !pt-[6px]"},{default:f(()=>[G(m.$slots,"name",{},void 0,!0)]),_:3})),(k(),R(z(o.value),{class:"load !pt-[6px] text-center"},{default:f(()=>[G(m.$slots,"load",{},()=>[S(c(e.tickets.length),1)],!0),h[2]||(h[2]=S("/",-1)),G(m.$slots,"load-max",{},()=>[h[1]||(h[1]=S("∞",-1))],!0)]),_:3})),(k(),R(z(o.value),{class:"complexity !pt-[6px] text-center"},{default:f(()=>[G(m.$slots,"complexity",{},()=>[S(c(n.value),1)],!0),h[4]||(h[4]=S("/",-1)),G(m.$slots,"complexity-max",{},()=>[h[3]||(h[3]=S("∞",-1))],!0)]),_:3})),r(Ka,{tag:o.value,tickets:e.tickets,class:N({collapsed:w(a)})},null,8,["tag","tickets","class"]),(k(),R(z(o.value),{class:"more !pt-[2px] text-center"},{default:f(()=>[r(A,{size:"x-small",variant:"tonal",icon:i.value,onClick:h[0]||(h[0]=V=>ke(a)?a.value=!w(a):a=!w(a))},null,8,["icon"])]),_:1}))],2))}}),Ke=le(qa,[["__scopeId","data-v-113cb187"]]),Ja=se({__name:"OperatorRow",props:{operator:{}},setup(e){const t=e,a=u(()=>({online:t.operator.online,ready:t.operator.ready,busy:!!t.operator.tickets?.length,full:t.operator.ticket_limit!==null&&t.operator.tickets?.length>=t.operator.ticket_limit})),o=xe(),n=async()=>await o.ready(t.operator.uuid,!t.operator.ready);return(i,s)=>(k(),R(Ke,{tickets:e.operator.tickets,"data-uuid":e.operator.uuid,class:N(["operator",a.value])},{status:f(()=>[r(Le,{icon:"mdi-account",onClick:n})]),"load-max":f(()=>[S(c(e.operator.ticket_limit??"∞"),1)]),"complexity-max":f(()=>[S(c(e.operator.complexity_limit??"∞"),1)]),name:f(()=>[S(c(e.operator.name),1)]),_:1},8,["tickets","data-uuid","class"]))}}),Qa=le(Ja,[["__scopeId","data-v-a776c74a"]]);function eo(e,t){return e.reduce((a,o)=>(typeof o[t]=="number"&&(a+=o[t]),a),0)}function Ve(e,t){return e.map(a=>Tt(a,t)).filter(a=>a)}function to(e,t){const a=Ve(e,t).filter(o=>typeof o=="number");return a.length===0?0:Math.max(...a)}function ao(e,t){const a=Ve(e,t).filter(o=>typeof o=="number");return a.length===0?0:Math.min(...a)}function oo(e){return e.map(t=>t[t.$getLocalKey()])}function no(e,t){const a={},o=Array.isArray(t)?t:[t];return e.forEach(n=>{const i=o.length===1?n[o[0]]:`[${o.map(s=>n[s]).toString()}]`;a[i]=(a[i]||[]).concat(n)}),a}function so(e,t,a){const o=[],n=[];return typeof t=="function"&&n.push(t)&&o.push("asc"),Array.isArray(t)&&t.forEach(i=>n.push(i[0])&&o.push(i[1])),n.length===0&&n.push(t),Vt(e,n,o,a)}function lo(e){return{sum:t=>eo(e,t),min:t=>ao(e,t),max:t=>to(e,t),pluck:t=>Ve(e,t),groupBy:t=>no(e,t),sortBy:(t,a="SORT_REGULAR")=>so(e,t,a),keys:()=>oo(e)}}const io={class:"text-xl leading-tight font-semibold text-gray-800"},ro={class:"align-top"},uo=se({__name:"Dashboard",props:{layout:{default:"default"},operators:{},operatorTeams:{},tickets:{},ticketCategories:{},factors:{},matchers:{}},setup(e){const t=e,a=He(),o=je(),n=At(),i=Dt(),s=u(()=>ae(Ut)),p=u(()=>ae(Ht)),d=u(()=>ae(Xe)),m=u(()=>ae(jt)),h=Ot(Xt),V=v=>Object.entries(n.value).reduce((g,[_,$])=>{const H=v?.[_],ee=H===void 0||!$.length||$.map(String).includes(H.toString());return g&&ee},!0),y=u(()=>lo(s.value.with("teams").with("tickets",v=>{v.with("category").where("meta",V).orderBy(o.value,"desc")}).whereHas("tickets").orWhere(v=>!a.hideEmpty&&v.online).get().filter(v=>!i.value.length||v.teams.some(g=>i.value.includes(g.uuid)))).sortBy([["online","desc"],["ready","desc"],["free_slots","desc"],["ticket_count","asc"],["name","asc"]])),I=u(()=>d.value.unbound().with("category").where("meta",V).orderBy(o.value,"desc").get()),T=xe(),M=D(null),{isOverDropZone:E}=Ye(M,async v=>{const g=v?.getData("text/plain");if(!g)throw new Error("Ticket UUID undefined.");return await T.close(g)},!1);Ue(()=>{h.listen(Wt.PropsInvalidated,()=>ye.reload()).listen(L.Enrolled,s.value.enroll).listen(L.Resigned,s.value.resign).listen(L.NameChanged,s.value.changeName).listen(L.Online,s.value.setOnline).listen(L.Offline,s.value.setOffline).listen(L.Ready,s.value.setReady).listen(L.NotReady,s.value.setNotReady).listen(L.TicketLimitAdjusted,s.value.adjustTicketLimit).listen(L.ComplexityLimitAdjusted,s.value.adjustComplexityLimit).listen(U.Created,d.value.create).listen(U.Closed,d.value.close).listen(U.Bound,d.value.bind).listen(U.Accepted,d.value.accept).listen(U.Unbound,d.value.unbind).listen(U.CategoryChanged,d.value.changeCategory).listen(U.MetaValueSet,d.value.setMetaValue).listen(U.MetaValuesMerged,d.value.mergeMetaValues).listen(U.MetricsAdjusted,d.value.adjustMetrics)});function B(){s.value.save(t.operators),p.value.fresh(t.operatorTeams),d.value.fresh(t.tickets),m.value.fresh(t.ticketCategories)}const O=ye.on("navigate",B),W=ye.on("success",B);$t(()=>{O(),W()});const x=v=>Object.entries(v).map(([g,_])=>({title:g,value:_}));return(v,g)=>(k(),C(Y,null,[r(w(Ct),{title:v.$t("dashboard")},null,8,["title"]),(k(),R(z(`${e.layout}-layout`),null,{header:f(()=>[l("h2",io,c(v.$t("dashboard")),1)]),default:f(()=>[l("div",null,[r(Jt,{fluid:""},{default:f(()=>[r(Se,null,{default:f(()=>[r(ce,null,{default:f(()=>[r(St,{modelValue:w(a).all,"onUpdate:modelValue":g[0]||(g[0]=_=>w(a).all=_),variant:"plain",multiple:""},{default:f(()=>[r(A,{value:"show-filters",icon:w(a).showFilters?"mdi-filter-outline":"mdi-filter-off-outline"},null,8,["icon"]),r(A,{value:"hide-empty",icon:w(a).hideEmpty?"mdi-eye-off-outline":"mdi-eye-outline"},null,8,["icon"]),r(A,{value:"alt-info",icon:w(a).altInfo?"mdi-magnify-plus-outline":"mdi-magnify"},null,8,["icon"]),r(A,{value:"unlocked",icon:w(a).unlocked?"mdi-lock-open-variant":"mdi-lock",color:"red",variant:w(a).unlocked?"text":"plain"},null,8,["icon","variant"])]),_:1},8,["modelValue"]),w(a).unlocked?(k(),R(It,{key:0,variant:"plain"},{default:f(()=>[r(A,{ref_key:"closeTicket",ref:M,icon:w(E)?"mdi-delete-empty":"mdi-delete"},null,8,["icon"]),r(A,{icon:"mdi-refresh"})]),_:1})):F("",!0)]),_:1}),r(ce,{cols:"2"},{default:f(()=>[r(Lt,{modelValue:w(o),"onUpdate:modelValue":g[1]||(g[1]=_=>ke(o)?o.value=_:null),"false-value":"weight","true-value":"duration","prepend-icon":"mdi-weight","append-icon":"mdi-clock",class:"d-flex justify-end"},null,8,["modelValue"])]),_:1})]),_:1}),w(a).showFilters?(k(),R(Se,{key:0},{default:f(()=>[r(ce,{cols:"2"},{default:f(()=>[r(Ie,{modelValue:w(i),"onUpdate:modelValue":g[2]||(g[2]=_=>ke(i)?i.value=_:null),multiple:"",clearable:"",chips:"","closable-chips":"",label:v.$t("teams"),items:e.operatorTeams,"item-title":"name","item-value":"uuid"},null,8,["modelValue","label","items"])]),_:1}),(k(!0),C(Y,null,ne(e.matchers,(_,$)=>(k(),R(ce,{key:$,cols:"2"},{default:f(()=>[r(Ie,{modelValue:w(n)[$],"onUpdate:modelValue":H=>w(n)[$]=H,multiple:"",clearable:"",chips:"","closable-chips":"",label:v.$t($),items:x(_)},null,8,["modelValue","onUpdate:modelValue","label","items"])]),_:2},1024))),128))]),_:1})):F("",!0)]),_:1}),r(Qt,{"fixed-header":"",height:"600px",density:"compact",class:"ticket-monitor"},{default:f(()=>[l("thead",ro,[r(Ke,{pool:"",tickets:I.value},{name:f(()=>[S(c(v.$t("ticket_pool")),1)]),_:1},8,["tickets"])]),r(w(Be),{tag:"tbody",class:"align-top",name:"operator-pool"},{default:f(()=>[(k(!0),C(Y,null,ne(y.value,_=>(k(),R(Qa,{key:_.uuid,operator:_},null,8,["operator"]))),128))]),_:1})]),_:1})])]),_:1}))],64))}}),To=le(uo,[["__scopeId","data-v-811338dd"]]);export{To as default};
//# sourceMappingURL=Dashboard-CRqwbDKH.js.map
