{"version":3,"file":"Personal-B6xu5Rhu.js","sources":["../../../resources/js/utils/filters.ts","../../../resources/js/components/PersonalTicket.vue","../../../resources/js/pages/Personal.vue"],"sourcesContent":["import dayjs from \"dayjs\";\n\nexport default {\n    timestamp: (date: Date) => {\n        const dt = dayjs(date);\n\n        return dt.isBefore(Date.now(), \"day\")\n            ? `${dt.format(\"L LT\")} (${dt.fromNow()})`\n            : `${dt.format(\"LT\")} (${dt.fromNow()})`;\n    },\n};\n","<template>\n    <tr class=\"personal-ticket\" :class=\"{ overflow }\">\n        <td v-for=\"[, key] in columns\" :key=\"key\">\n            <v-icon v-if=\"key === 'meta.icon'\" :icon=\"retrieve(ticket, key, 'mdi-help')\" color=\"white\" />\n            <span v-else v-html=\"md.renderInline(retrieve(ticket, key, '-'))\"></span>\n        </td>\n    </tr>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from \"vue\";\n// @ts-expect-error Helper function not exported\nimport { getObjectValueByPath } from \"vuetify/lib/util/helpers\";\nimport MarkdownIt from \"markdown-it\";\nimport MarkdownItAttrs from \"markdown-it-attrs\";\nimport { usePage } from \"@inertiajs/vue3\";\nimport Ticket from \"@/models/Ticket\";\nimport { useSharedDisplayMode } from \"@/shared\";\nimport { filters } from \"@/utils\";\nimport type { DisplayOptions } from \"@/types\";\n\nconst props = defineProps<{\n    ticket: Ticket;\n    columns: [string, string][];\n}>();\n\nconst md = new MarkdownIt({ linkify: true }).use(MarkdownItAttrs);\n\nconst mode = useSharedDisplayMode();\n\nconst config = computed(() => usePage().props.options as DisplayOptions);\n\nconst threshold = computed(() => config.value[`${mode.value}_threshold`]);\n\nconst position = computed(() => props.ticket[mode.value]);\n\nconst overflow = computed(() => position.value > threshold.value);\n\nconst animation = computed(() => ({\n    delay: -position.value + \"s\",\n    duration: threshold.value + \"s\",\n}));\n\nfunction retrieve(obj: object, key: string, fallback: string = \"\"): string {\n    const [path, ...sequence] = key.split(\"|\");\n    const value = getObjectValueByPath(obj, path, fallback);\n\n    return value === fallback\n        ? value\n        : sequence.reduce((accum, filter) => filters[filter as keyof typeof filters](accum), value);\n}\n</script>\n\n<style scoped>\n.personal-ticket:deep(a:hover) {\n    text-decoration: underline;\n}\n\n.personal-ticket td:nth-child(-n + 2):deep(a) {\n    color: white;\n}\n\n.personal-ticket td:nth-child(-n + 2) {\n    animation-delay: v-bind(\"animation.delay\");\n    animation-duration: v-bind(\"animation.duration\");\n}\n</style>\n","<template>\n    <Head :title=\"$t('personal')\" />\n\n    <component :is=\"`${layout}-layout`\">\n        <template #header>\n            <h2 class=\"text-xl leading-tight font-semibold text-gray-800\">{{ $t(\"personal\") }}</h2>\n        </template>\n\n        <div>\n            <v-container fluid>\n                <v-row>\n                    <v-col offset=\"10\" cols=\"2\">\n                        <v-switch\n                            v-model=\"mode\"\n                            false-value=\"weight\"\n                            true-value=\"duration\"\n                            prepend-icon=\"mdi-weight\"\n                            append-icon=\"mdi-clock\"\n                            class=\"d-flex justify-end\"\n                        />\n                    </v-col>\n                </v-row>\n            </v-container>\n            <v-table v-if=\"computedOperator\" fixed-header density=\"compact\" class=\"personal-monitor\">\n                <thead>\n                    <tr>\n                        <th v-for=\"[title, key] in columns\" :key=\"key\">{{ title }}</th>\n                    </tr>\n                </thead>\n                <TransGroup tag=\"tbody\" name=\"ticket-pool\">\n                    <PersonalTicket\n                        v-for=\"ticket in computedOperator.tickets\"\n                        :key=\"ticket.uuid\"\n                        :ticket=\"ticket\"\n                        :columns=\"columns\"\n                    />\n                </TransGroup>\n            </v-table>\n        </div>\n    </component>\n</template>\n\n<script setup lang=\"ts\">\nimport PersonalTicket from \"@/components/PersonalTicket.vue\";\nimport { TransitionGroup as TransGroup } from \"@/components/TransitionGroup\";\nimport { Head, router } from \"@inertiajs/vue3\";\nimport { computed, onMounted, onUnmounted } from \"vue\";\nimport { usePusherChannel } from \"@/composables\";\nimport type { Operator, Ticket } from \"@/types\";\nimport { useSharedDisplayMode } from \"@/shared\";\nimport * as Events from \"@/types/events.d\";\n\nimport { useRepo } from \"pinia-orm\";\nimport OperatorRepository from \"@/repositories/OperatorRepository\";\nimport TicketRepository from \"@/repositories/TicketRepository\";\n\nconst props = withDefaults(\n    defineProps<{\n        layout: string;\n        operator: Operator;\n        tickets: Ticket[];\n        columns: [string, string][];\n    }>(),\n    {\n        layout: \"default\",\n    },\n);\n\nconst mode = useSharedDisplayMode();\n\nconst operatorRepo = computed(() => useRepo(OperatorRepository));\nconst ticketRepo = computed(() => useRepo(TicketRepository));\nconst channel = usePusherChannel(Events.Channel);\n\nconst computedOperator = computed(\n    () => operatorRepo.value.with(\"tickets\", (query) => query.with(\"category\").orderBy(mode.value, \"desc\")).first()!,\n);\n\nonMounted(() => {\n    channel\n        .listen(Events.Common.PropsInvalidated, () => router.reload())\n        .listen(Events.Ticket.Created, ticketRepo.value.create)\n        .listen(Events.Ticket.Closed, ticketRepo.value.close)\n        .listen(Events.Ticket.Bound, ticketRepo.value.bind)\n        .listen(Events.Ticket.Accepted, ticketRepo.value.accept)\n        .listen(Events.Ticket.Unbound, ticketRepo.value.unbind)\n        .listen(Events.Ticket.CategoryChanged, ticketRepo.value.changeCategory)\n        .listen(Events.Ticket.MetaValueSet, ticketRepo.value.setMetaValue)\n        .listen(Events.Ticket.MetaValuesMerged, ticketRepo.value.mergeMetaValues)\n        .listen(Events.Ticket.MetricsAdjusted, ticketRepo.value.adjustMetrics);\n});\n\nfunction refreshRepositories() {\n    operatorRepo.value.fresh(props.operator);\n    ticketRepo.value.fresh(props.tickets);\n}\n\nconst removeNavigateEventListener = router.on(\"navigate\", refreshRepositories);\nconst removeSuccessEventListener = router.on(\"success\", refreshRepositories);\n\nonUnmounted(() => {\n    removeNavigateEventListener();\n    removeSuccessEventListener();\n});\n</script>\n\n<style scoped>\n.ticket-pool-move {\n    transition: transform 0.5s ease-in-out;\n}\n</style>\n"],"names":["filters","date","dt","dayjs","props","__props","md","MarkdownIt","MarkdownItAttrs","mode","useSharedDisplayMode","config","computed","usePage","threshold","position","overflow","animation","retrieve","obj","key","fallback","path","sequence","value","getObjectValueByPath","accum","filter","_createElementBlock","_normalizeClass","_Fragment","_renderList","_createBlock","_component_v_icon","_unref","operatorRepo","useRepo","OperatorRepository","ticketRepo","TicketRepository","channel","usePusherChannel","Events.Channel","computedOperator","query","onMounted","Events.Common","router","Events.Ticket","refreshRepositories","removeNavigateEventListener","removeSuccessEventListener","onUnmounted","_createVNode","Head","$t","_openBlock","_resolveDynamicComponent","_createElementVNode","_hoisted_1","_toDisplayString","_component_v_container","_component_v_row","_component_v_col","_component_v_switch","$event","_component_v_table","title","TransGroup","ticket","PersonalTicket"],"mappings":"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"}